# å…¨ç”Ÿå‘½å‘¨æœŸå¿«é€Ÿå¼€å‘æµ‹è¯• (Full Lifecycle Fast Dev Run) æŒ‡å—

æœ¬æ–‡æ¡£æä¾›äº†åœ¨æœ¬é¡¹ç›®ä¸­æ‰§è¡Œä¸€ä¸ªå®Œæ•´çš„ã€ç«¯åˆ°ç«¯çš„æ¨¡å‹ç”Ÿå‘½å‘¨æœŸâ€œå†’çƒŸæµ‹è¯•â€æ‰€éœ€çš„æ‰€æœ‰å‘½ä»¤ã€‚

æ‰€æœ‰å‘½ä»¤éƒ½ä½¿ç”¨äº† `--fast_dev_run` æ ‡å¿—ï¼Œè¿™æ„å‘³ç€ï¼š
1.  **è‡ªåŠ¨åŒ–ä¾èµ–**: æ¯ä¸ªåç»­æ­¥éª¤éƒ½ä¼šè‡ªåŠ¨æŸ¥æ‰¾å¹¶ä½¿ç”¨å‰åºæ­¥éª¤ç”Ÿæˆçš„æ¨¡å‹æ£€æŸ¥ç‚¹ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚
2.  **å¿«é€Ÿè¿­ä»£**: æ¯æ¬¡è¿è¡Œæ—¶ï¼Œæ—§çš„ `fast-dev-run` è¾“å‡ºç›®å½•ä¼šè¢«è‡ªåŠ¨æ¸…ç†ï¼Œæ–¹ä¾¿å¿«é€Ÿé‡æ–°å¼€å§‹å’Œè°ƒè¯•ã€‚
3.  **ç›®æ ‡**: è¿™äº›å‘½ä»¤çš„ä¸»è¦ç›®æ ‡æ˜¯éªŒè¯æ•´ä¸ªä»£ç åº“æµç¨‹çš„æ­£ç¡®æ€§ï¼Œè€Œä¸æ˜¯è®­ç»ƒå‡ºé«˜æ€§èƒ½çš„æ¨¡å‹ã€‚

---

### ç¬¬é›¶æ­¥: å‡†å¤‡æ•°æ® (å¦‚æœå°šæœªå®Œæˆ)

åœ¨æ‰§è¡Œä»»ä½•è®­ç»ƒä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„æ•°æ®æ–‡ä»¶éƒ½å·²ç”Ÿæˆã€‚è¿™äº›å‘½ä»¤é€šå¸¸åªéœ€è¦è¿è¡Œä¸€æ¬¡ã€‚

```bash
# ç”Ÿæˆé¢„è®­ç»ƒå’ŒéªŒè¯æ•°æ® (.bin æ–‡ä»¶)
python data_pipeline/processing/build_pretrain_bins.py

# ç”ŸæˆSFT (æŒ‡ä»¤å¾®è°ƒ) æ•°æ® (.bin æ–‡ä»¶)
python data_pipeline/processing/build_sft_bins.py

# ç”Ÿæˆç”¨äºRMå’ŒDPO/ORPOçš„åå¥½æ•°æ® (.bin æ–‡ä»¶)
python data_pipeline/processing/build_preference_bins.py

# ä¸‹è½½ç”¨äºPPO/GSPOç­‰åœ¨çº¿å¯¹é½ç®—æ³•çš„ prompts (.txt æ–‡ä»¶)
python data_pipeline/download/download_prompts.py
```

---

### ç¬¬ä¸€æ­¥: é¢„è®­ç»ƒ (Pre-training)

**ç›®æ ‡**: ä»é›¶å¼€å§‹è®­ç»ƒä¸€ä¸ªåŸºç¡€è¯­è¨€æ¨¡å‹ï¼Œå¹¶å°†å…¶ä¿å­˜ã€‚è¿™æ˜¯åç»­æ‰€æœ‰å¾®è°ƒå’Œå¯¹é½æ­¥éª¤çš„åŸºç¡€ã€‚

#### A) æ ‡å‡†å•è¿›ç¨‹æ¨¡å¼

è¿™æ˜¯æœ€ç®€å•çš„è¿è¡Œæ–¹å¼ï¼Œç”¨äºåŸºç¡€åŠŸèƒ½éªŒè¯ã€‚

```bash
python pretrain/train.py --config_path configs/pretrain/1.4M_pretrain_fast.yaml --fast_dev_run
```

#### B) DDP å¤šè¿›ç¨‹æ¨¡å¼ (æ¨èç”¨äºæ€§èƒ½æµ‹è¯•)

DDPï¼ˆåˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œï¼‰å¯ä»¥åœ¨å¤šæ ¸CPUæˆ–å¤šGPUä¸ŠåŠ é€Ÿè®­ç»ƒã€‚æˆ‘ä»¬ä½¿ç”¨ PyTorch å®˜æ–¹çš„ `torchrun` å¯åŠ¨å™¨ã€‚

**åœ¨ Windows (PowerShell) ä¸Šè¿è¡Œ:**
> æ³¨æ„ï¼šWindows ä¸Šçš„ DDP éœ€è¦æ˜ç¡®æŒ‡å®š rendezvous (é›†åˆç‚¹) çš„åœ°å€å’Œç«¯å£ã€‚

```powershell
# ä½¿ç”¨ 2 ä¸ª CPU æ ¸å¿ƒè¿›è¡Œå¹¶è¡Œè®­ç»ƒ
torchrun --nproc_per_node=2 --rdzv_backend=static --rdzv_endpoint=localhost:29500 --rdzv_id=fast-dev-run-job pretrain/train.py --config_path configs/pretrain/1.4M_pretrain_fast.yaml --fast_dev_run
```

**åœ¨ Linux / macOS ä¸Šè¿è¡Œ:**
> åœ¨è¿™äº›ç³»ç»Ÿä¸Šï¼Œç½‘ç»œé…ç½®é€šå¸¸å¯ä»¥è¢«è‡ªåŠ¨æ¨æ–­ï¼Œå‘½ä»¤æ›´ç®€æ´ã€‚

```bash
# ä½¿ç”¨ 4 ä¸ª CPU æ ¸å¿ƒè¿›è¡Œå¹¶è¡Œè®­ç»ƒ
torchrun --nproc_per_node=4 pretrain/train.py --config_path configs/pretrain/1.4M_pretrain_fast.yaml --fast_dev_run
```

**äº§å‡º**: åœ¨ `runs/pretrain/fast-dev-run/checkpoints/` ç›®å½•ä¸‹ç”Ÿæˆ `ckpt_best.pth` å’Œ `ckpt_latest.pth`ã€‚

---

### ç¬¬äºŒæ­¥: è¯„ä¼°é¢„è®­ç»ƒæ¨¡å‹ (å¯é€‰)

**ç›®æ ‡**: éªŒè¯ç¬¬ä¸€æ­¥ç”Ÿæˆçš„é¢„è®­ç»ƒæ¨¡å‹çš„åŸºæœ¬æ€§èƒ½ï¼ˆå›°æƒ‘åº¦ PPLï¼‰ã€‚

```bash
python evaluation/evaluate.py --config_path configs/pretrain/1.4M_pretrain_fast.yaml --checkpoint_path runs/pretrain/fast-dev-run/checkpoints/ckpt_best.pth
```

---

### ç¬¬ä¸‰æ­¥: ç›‘ç£å¾®è°ƒ (SFT)

**ç›®æ ‡**: åœ¨é¢„è®­ç»ƒæ¨¡å‹çš„åŸºç¡€ä¸Šè¿›è¡ŒæŒ‡ä»¤å¾®è°ƒï¼Œä½¿å…¶å…·å¤‡éµå¾ªæŒ‡ä»¤å’Œè¿›è¡ŒåŸºç¡€å¯¹è¯çš„èƒ½åŠ›ã€‚

#### A) å…¨é‡å¾®è°ƒ (Full Fine-tuning)
```bash
python finetune/full/sft_train.py --config_path configs/sft/full/1.4M_sft_full.yaml --fast_dev_run
```
**äº§å‡º**: åœ¨ `runs/sft/full/fast-dev-run/checkpoints/` ç›®å½•ä¸‹ç”ŸæˆSFTæ¨¡å‹ã€‚

#### B) LoRA å¾®è°ƒ (Parameter-Efficient Fine-tuning)
```bash
python finetune/peft/lora/sft_lora_train.py --config_path configs/sft/peft/lora/1.4M_sft_lora.yaml --fast_dev_run
```
**äº§å‡º**: åœ¨ `runs/sft/peft/lora/fast-dev-run/checkpoints/` ç›®å½•ä¸‹ç”ŸæˆLoRAé€‚é…å™¨ã€‚

---

### ç¬¬å››æ­¥: ä¸SFTæ¨¡å‹èŠå¤© (å¯é€‰)

**ç›®æ ‡**: ç›´è§‚åœ°æ„Ÿå—SFTæ¨¡å‹çš„æ•ˆæœï¼Œè¿›è¡Œäº¤äº’å¼å¯¹è¯ã€‚

```bash
# æ³¨æ„: checkpoint_path æŒ‡å‘ä½ æƒ³è¦èŠå¤©çš„æ¨¡å‹è·¯å¾„ï¼Œè¿™é‡Œä»¥å…¨é‡å¾®è°ƒçš„æ¨¡å‹ä¸ºä¾‹ã€‚
python inference/chat.py --config_path configs/sft/full/1.4M_sft_full.yaml --checkpoint_path runs/sft/full/fast-dev-run/checkpoints/ckpt_best.pth
```

---

### ç¬¬äº”æ­¥: å¥–åŠ±æ¨¡å‹ (RM) è®­ç»ƒ

**ç›®æ ‡**: è®­ç»ƒä¸€ä¸ªèƒ½åŒºåˆ†â€œå¥½â€å›ç­”å’Œâ€œåâ€å›ç­”çš„æ¨¡å‹ã€‚è¿™æ˜¯åç»­RLHFå¯¹é½æ­¥éª¤çš„å…³é”®ç»„ä»¶ã€‚

```bash
python align/rm_train.py --config_path configs/rlhf/rm/1.4M_rm.yaml --fast_dev_run
```
**äº§å‡º**: åœ¨ `runs/rlhf/rm/fast-dev-run/checkpoints/` ç›®å½•ä¸‹ç”Ÿæˆå¥–åŠ±æ¨¡å‹ã€‚

---

### ç¬¬å…­æ­¥: RLHF - ç¦»çº¿å¯¹é½ (Offline Alignment)

**ç›®æ ‡**: ä½¿ç”¨DPOã€ORPOç­‰æ— éœ€åœ¨çº¿é‡‡æ ·å’Œå¥–åŠ±æ¨¡å‹çš„ç®€åŒ–RLç®—æ³•ï¼Œè¿›ä¸€æ­¥å¯¹é½SFTæ¨¡å‹ã€‚

#### A) DPO (Direct Preference Optimization)
```bash
python align/train_offline.py --config_path configs/rlhf/offline/dpo/1.4M_dpo.yaml --fast_dev_run
```

#### B) ORPO (Odds Ratio Preference Optimization)
```bash
python align/train_offline.py --config_path configs/rlhf/offline/orpo/1.4M_orpo.yaml --fast_dev_run
```
**äº§å‡º**: åœ¨ `runs/rlhf/offline/dpo-fast-dev-run/` å’Œ `orpo-fast-dev-run/` ç›®å½•ä¸‹ç”Ÿæˆå¯¹é½åçš„æ¨¡å‹ã€‚

---

### ç¬¬ä¸ƒæ­¥: RLHF - åœ¨çº¿å¯¹é½ (Online Alignment)

**ç›®æ ‡**: ä½¿ç”¨PPOã€GSPOç­‰ç»å…¸çš„åœ¨çº¿å¼ºåŒ–å­¦ä¹ ç®—æ³•ï¼Œé€šè¿‡ä¸å¥–åŠ±æ¨¡å‹äº’åŠ¨æ¥è¿›ä¸€æ­¥å¯¹é½SFTæ¨¡å‹ã€‚

#### A) PPO (Proximal Policy Optimization)```bash
python align/train_online.py --config_path configs/rlhf/online/ppo/1.4M_ppo.yaml --fast_dev_run
```

#### B) GSPO (Group Sequence Policy Optimization)
```bash
python align/train_online.py --config_path configs/rlhf/online/gspo/1.4M_gspo.yaml --fast_dev_run
```

#### C) GRPO (Group Relative Policy Optimization)
```bash
python align/train_online.py --config_path configs/rlhf/online/grpo/1.4M_grpo.yaml --fast_dev_run
```
**äº§å‡º**: åœ¨ `runs/rlhf/online/` çš„ç›¸åº”ç®—æ³•ç›®å½•ä¸‹ç”Ÿæˆå¯¹é½åçš„æ¨¡å‹ã€‚

---

ğŸ‰ è¿è¡Œå®Œä»¥ä¸Šæ‰€æœ‰æ­¥éª¤ï¼Œå³å®Œæˆäº†ä¸€æ¬¡å®Œæ•´çš„æ¨¡å‹ç”Ÿå‘½å‘¨æœŸéªŒè¯ï¼
