# FILE: configs/smoke_test_config.yaml
# ===================================================================
# 冒烟测试专用配置 (Smoke Test Configuration)
# 目标：在几分钟内快速跑完一个完整的训练-评估-保存流程，
#       以验证代码的正确性和监控系统的有效性。
# ===================================================================

# -- 1. 运行与输出配置 --
run_name: "smoke-test-{timestamp}"
output_dir: "./runs/" # 所有输出的根目录
device: "cpu" # 强制使用CPU，确保在任何环境下都能快速启动测试

# -- 2. 数据配置 --
data:
  # 使用我们已经处理好的数据和分词器
  data_dir: "./data_pipeline/processed_data/"
  tokenizer_name: "./data_pipeline/processed_data/tinystories_project_vs4096.json"

# -- 3. 模型配置 (一个极小的模型) --
model:
  dim: 128          # 维度极小
  n_layers: 2       # 层数极少
  n_heads: 4        # 头数少
  n_kv_heads: 2     # GQA配置
  vocab_size: 4096  # 与分词器匹配
  multiple_of: 32   # 保持硬件友好
  norm_eps: 1.0e-5
  max_seq_len: 256  # 使用较短的序列长度以加速
  dropout: 0.0      # 测试时关闭dropout

# -- 4. 训练超参数 (为快速迭代而设计) --
training:
  batch_size: 4                 # 小批量
  gradient_accumulation_steps: 1  # 无梯度累积，立即更新
  max_epochs: 2                   # 只训练2个epoch
  learning_rate: 1.0e-4
  weight_decay: 0.01
  clip_grad_norm: 1.0           # 保持梯度裁剪开启，以测试动态裁剪
  warmup_ratio: 0.1             # 快速预热
  min_lr_ratio: 0.1

# -- 5. 日志配置 (高频记录) --
logging:
  log_interval: 2  # !!! 关键：每2步就记录一次日志，以便我们能立即看到监控数据
  # --- SwanLab 配置 ---
  swanlab:
    enable: true
    project: "LLM-From-Scratch-Smoke-Test"
    experiment_name: "{run_name}"
  # --- WandB 配置 (如果需要可以开启) ---
  wandb:
    enable: false
    project: "LLM-From-Scratch-Smoke-Test"

# -- 6. 检查点配置 (高频保存) --
checkpointing:
  save_interval: 10 # !!! 关键：每10步就保存一次检查点，以测试保存功能
  resume_from: "none" # 从头开始

# END OF FILE: configs/smoke_test_config.yaml